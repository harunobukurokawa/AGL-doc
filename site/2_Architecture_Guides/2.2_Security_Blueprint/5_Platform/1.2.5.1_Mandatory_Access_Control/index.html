<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Shankho Boron Ghosh">
    <link rel="canonical" href="http://docs.automotivelinux.org/2_Architecture_Guides/2.2_Security_Blueprint/5_Platform/1.2.5.1_Mandatory_Access_Control/">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Mandatory Access Control - AGL Documentation</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Mandatory Access Control", url: "#_top", children: [
              {title: "Floor", url: "#floor" },
              {title: "System", url: "#system" },
              {title: "Applications, Services and User", url: "#applications-services-and-user" },
              {title: "Attack Vectors", url: "#attack-vectors" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1.2.5.2_SystemD/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1.2.5.2_SystemD/" class="btn btn-xs btn-link">
        SystemD
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.2.5.0_Abstract/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.2.5.0_Abstract/" class="btn btn-xs btn-link">
        Introduction
      </a>
    </div>
    
  </div>

    

    <h1 id="mandatory-access-control">Mandatory Access Control</h1>
<!-- section-note -->

<p>We decided to put the <strong>MAC</strong> protection on the platform part despite the fact
that it applies to the kernel too, since its use will be mainly at the platform
level (except floor part).</p>
<!-- end-section-note -->

<p><strong>M</strong>andatory <strong>A</strong>ccess <strong>C</strong>ontrol (<strong>MAC</strong>) is a protection provided by the
Linux kernel that requires a <strong>L</strong>inux <strong>S</strong>ecurity <strong>M</strong>odule (<strong>LSM</strong>). AGL
uses an <strong>LSM</strong> called <strong>S</strong>implified <strong>M</strong>andatory <strong>A</strong>ccess <strong>C</strong>ontrol
<strong>K</strong>ernel (<strong>SMACK</strong>). This protection involves the creation of <strong>SMACK</strong>
labels as part of the extended attributes <strong>SMACK</strong> labels to the file extended
attributes. And a policy is also created to define the behaviour of each label.</p>
<p>The kernel access controls is based on these labels and this policy. If there is
no rule, no access will be granted and as a consequence, what is not explicitly
authorized is forbidden.</p>
<p>There are two types of <strong>SMACK</strong> labels:</p>
<ul>
<li><strong>Execution SMACK</strong> (Attached to the process): Defines how files are
  <em>accessed</em> and <em>created</em> by that process.</li>
<li><strong>File Access SMACK</strong> (Written to the extended attribute of the file): Defines
  <em>which</em> process can access the file.</li>
</ul>
<p>By default a process executes with its File Access <strong>SMACK</strong> label unless an
Execution <strong>SMACK</strong> label is defined.</p>
<p>AGL's <strong>SMACK</strong> scheme is based on the <em>Tizen 3 Q2/2015</em>. It divides the System
into the following domains:</p>
<ul>
<li>Floor.</li>
<li>System.</li>
<li>Applications, Services and User.</li>
</ul>
<p>See <a href="http://iot.bzh/download/public/2017/AMMQ1Tokyo/AGL-security-framework-review.pdf">AGL security framework
review</a>
and <a href="http://schaufler-ca.com/yahoo_site_admin/assets/docs/SmackWhitePaper.257153003.pdf">Smack White
Paper</a>
for more information.</p>
<hr />
<!-- pagebreak -->

<h2 id="floor">Floor</h2>
<p>The <em>floor</em> domain includes the base system services and any associated data and
libraries. This data remains unchanged at runtime. Writing to floor files or
directories is allowed only in development mode or during software installation
or upgrade.</p>
<p>The following table details the <em>floor</em> domain:</p>
<table>
<thead>
<tr>
<th>Label</th>
<th>Name</th>
<th>Execution <strong>SMACK</strong></th>
<th>File Access <strong>SMACK</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-</code></td>
<td>Floor</td>
<td><code>r-x</code> for all</td>
<td>Only kernel and internal kernel thread.</td>
</tr>
<tr>
<td><code>^</code></td>
<td>Hat</td>
<td><code>---</code> for all</td>
<td><code>rx</code> on all domains.</td>
</tr>
<tr>
<td><code>*</code></td>
<td>Star</td>
<td><code>rwx</code> for all</td>
<td>None</td>
</tr>
</tbody>
</table>
<!-- section-note -->

<ul>
<li>
<p>The Hat label is Only for privileged system services (currently only
  systemd-journal). Useful for backup or virus scans. No file with this label
  should exist except in the debug log.</p>
</li>
<li>
<p>The Star label is used for device files or <code>/tmp</code> Access restriction managed
  via <strong>DAC</strong>. Individual files remain protected by their <strong>SMACK</strong> label.</p>
</li>
</ul>
<!-- end-section-note -->
<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Label</code> name</th>
<th>Recommendations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-MAC-Floor-1</td>
<td><code>^</code></td>
<td>Only for privileged system services.</td>
</tr>
<tr>
<td>Kernel-MAC-Floor-2</td>
<td><code>*</code></td>
<td>Used for device files or <code>/tmp</code> Access restriction via DAC.</td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<!-- pagebreak -->

<h2 id="system">System</h2>
<p>The <em>system</em> domain includes a reduced set of core system services of the OS and
any associated data. This data may change at runtime.</p>
<p>The following table details the <em>system</em> domain:</p>
<table>
<thead>
<tr>
<th>Label</th>
<th>Name</th>
<th>Execution <strong>SMACK</strong></th>
<th>File Access <strong>SMACK</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>System</code></td>
<td>System</td>
<td>None</td>
<td>Privileged processes</td>
</tr>
<tr>
<td><code>System::Run</code></td>
<td>Run</td>
<td><code>rwxatl</code> for User and System label</td>
<td>None</td>
</tr>
<tr>
<td><code>System::Shared</code></td>
<td>Shared</td>
<td><code>rwxatl</code> for system domain <code>r-x</code> for User label</td>
<td>None</td>
</tr>
<tr>
<td><code>System::Log</code></td>
<td>Log</td>
<td><code>rwa</code> for System label <code>xa</code> for user label</td>
<td>None</td>
</tr>
<tr>
<td><code>System::Sub</code></td>
<td>SubSystem</td>
<td>Subsystem Config files</td>
<td>SubSystem only</td>
</tr>
</tbody>
</table>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Label</code> name</th>
<th>Recommendations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-MAC-System-1</td>
<td><code>System</code></td>
<td>Process should write only to file with transmute attribute.</td>
</tr>
<tr>
<td>Kernel-MAC-System-2</td>
<td><code>System::run</code></td>
<td>Files are created with the directory label from user and system domain (transmute) Lock is implicit with <code>w</code>.</td>
</tr>
<tr>
<td>Kernel-MAC-System-3</td>
<td><code>System::Shared</code></td>
<td>Files are created with the directory label from system domain (transmute) User domain has locked privilege.</td>
</tr>
<tr>
<td>Kernel-MAC-System-4</td>
<td><code>System::Log</code></td>
<td>Some limitation may impose to add <code>w</code> to enable append.</td>
</tr>
<tr>
<td>Kernel-MAC-System-5</td>
<td><code>System::Sub</code></td>
<td>Isolation of risky Subsystem.</td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<!-- pagebreak -->

<h2 id="applications-services-and-user">Applications, Services and User</h2>
<p>The <em>application</em>, <em>services</em> and <em>user</em> domain includes code that provides
services to the system and user, as well as any associated data. All code
running on this domain is under <em>Cynara</em> control.</p>
<p>The following table details the <em>application</em>, <em>services</em> and <em>user</em> domain:</p>
<table>
<thead>
<tr>
<th>Label</th>
<th>Name</th>
<th>Execution <strong>SMACK</strong></th>
<th>File Access <strong>SMACK</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>User::Pkg::$AppID</code></td>
<td>AppID</td>
<td><code>rwx</code> (for files created by the App). <code>rx</code> for files installed by <strong>AppFw</strong></td>
<td>$App runtime executing $App</td>
</tr>
<tr>
<td><code>User::Home</code></td>
<td>Home</td>
<td><code>rwx-t</code> from System label <code>r-x-l</code> from App</td>
<td>None</td>
</tr>
<tr>
<td><code>User::App-Shared</code></td>
<td>Shared</td>
<td><code>rwxat</code> from System and User domains label of $User</td>
<td>None</td>
</tr>
</tbody>
</table>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Label</code> name</th>
<th>Recommendations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-MAC-System-1</td>
<td><code>User::Pkg::$AppID</code></td>
<td>Only one Label is allowed per App. A data directory is created by the AppFw in <code>rwx</code> mode.</td>
</tr>
<tr>
<td>Kernel-MAC-System-2</td>
<td><code>User::Home</code></td>
<td>AppFw needs to create a directory in <code>/home/$USER/App-Shared</code> at first launch if not present with label app-data access is <code>User::App-Shared</code> without transmute.</td>
</tr>
<tr>
<td>Kernel-MAC-System-3</td>
<td><code>User::App-Shared</code></td>
<td>Shared space between all App running for a given user.</td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<h2 id="attack-vectors">Attack Vectors</h2>
<p>There are 4 major components to the system:</p>
<ul>
<li>The LSM kernel module.</li>
<li>The <code>smackfs</code> filesystem.</li>
<li>Basic utilities for policy management and checking.</li>
<li>The policy/configuration data.</li>
</ul>
<p>As with any mandatory access system, the policy management needs to be carefully
separated from the checking, as the management utilities can become a convenient
point of attack. Dynamic additions to the policy system need to be carefully
verified, as the ability to update the policies is often needed, but introduces
a possible threat. Finally, even if the policy management is well secured, the
policy checking and failure response to that checking is also of vital
importance to the smooth operation of the system.</p>
<p>While <strong>MAC</strong> is a certainly a step up in security when compared to DAC, there
are still many ways to compromise a SMACK-enabled Linux system. Some of these
ways are as follows:</p>
<ul>
<li>Disabling SMACK at invocation of the kernel (with command-line:
  security=none).</li>
<li>Disabling SMACK in the kernel build and redeploying the kernel.</li>
<li>Changing a SMACK attribute of a file or directory at install time.</li>
<li>Tampering with a process with the CAP_MAC_ADMIN privilege.</li>
<li>Setting/Re-setting the SMACK label of a file.</li>
<li>Tampering with the default domains (i.e.
  /etc/smack/accesses.d/default-access-domains).</li>
<li>Disabling or tampering with the SMACK filesystem (i.e. /smackfs).</li>
<li>Adding policies with <code>smackload</code> (adding the utility if not present).</li>
<li>Changing labels with <code>chsmack</code> (adding the utility if not present).</li>
</ul>
<!-- section-config -->

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1.2.5.2_SystemD/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1.2.5.2_SystemD/" class="btn btn-xs btn-link">
        SystemD
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.2.5.0_Abstract/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.2.5.0_Abstract/" class="btn btn-xs btn-link">
        Introduction
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>