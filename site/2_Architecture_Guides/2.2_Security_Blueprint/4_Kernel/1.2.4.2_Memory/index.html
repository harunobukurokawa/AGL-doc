<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Shankho Boron Ghosh">
    <link rel="canonical" href="http://docs.automotivelinux.org/2_Architecture_Guides/2.2_Security_Blueprint/4_Kernel/1.2.4.2_Memory/">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Memory - AGL Documentation</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Memory", url: "#_top", children: [
              {title: "Restrict access to kernel memory", url: "#restrict-access-to-kernel-memory" },
              {title: "Disable access to a kernel core dump", url: "#disable-access-to-a-kernel-core-dump" },
              {title: "Disable swap", url: "#disable-swap" },
              {title: "Disable \"Load All Symbols\"", url: "#disable-load-all-symbols" },
              {title: "Stack protection", url: "#stack-protection" },
              {title: "Disable access to /dev/mem", url: "#disable-access-to-devmem" },
              {title: "Disable cross-memory attach", url: "#disable-cross-memory-attach" },
              {title: "Stack Smashing Attacks", url: "#stack-smashing-attacks" },
              {title: "Detect Buffer Overflows", url: "#detect-buffer-overflows" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1.2.4.3_Consoles/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1.2.4.3_Consoles/" class="btn btn-xs btn-link">
        Consoles
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.2.4.1_General/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.2.4.1_General/" class="btn btn-xs btn-link">
        General
      </a>
    </div>
    
  </div>

    

    <h1 id="memory">Memory</h1>
<h2 id="restrict-access-to-kernel-memory">Restrict access to kernel memory</h2>
<p>The /dev/kmem file in Linux systems is directly mapped to kernel virtual memory.
This can be disastrous if an attacker gains root access, as the attacker would
have direct access to kernel virtual memory.</p>
<p>To disable the /dev/kmem file, which is very infrequently used by applications,
the following kernel option should be set in the compile-time kernel
configuration:</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-RestrictAccess-1</td>
<td><code>CONFIG_DEVKMEM</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>In case applications in userspace need /dev/kmem support, it should be available
only for authenticated applications.</p>
<hr />
<h2 id="disable-access-to-a-kernel-core-dump">Disable access to a kernel core dump</h2>
<p>This kernel configuration disables access to a kernel core dump from user space.
If enabled, it gives attackers a useful view into kernel memory.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-CoreDump-1</td>
<td><code>CONFIG_PROC_KCORE</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-swap">Disable swap</h2>
<p>If not disabled, attackers can enable swap at runtime, add pressure to the
memory subsystem and then scour the pages written to swap for useful
information.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-Swap-1</td>
<td><code>CONFIG_SWAP</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<!-- section-note -->

<ul>
<li>Enabling swap at runtime require <code>CAP_SYS_ADMIN</code>.</li>
<li>Swap block device is usually under root:disk.</li>
<li>Linux never swaps kernel pages.</li>
<li>If swap disabling is not possible, swap encryption should be enabled.</li>
</ul>
<!-- end-section-note -->

<hr />
<!-- pagebreak -->

<h2 id="disable-load-all-symbols">Disable "Load All Symbols"</h2>
<p>There is a /proc/kallsyms file which exposes the kernel memory space address of
many kernel symbols (functions, variables, etc...). This information is useful
to attackers in identifying kernel versions/configurations and in preparing
payloads for the exploits of kernel space.</p>
<p>Both <code>KALLSYMS_ALL</code> and <code>KALLSYMS</code> shall be disabled;</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-LoadAllSymbols-1</td>
<td><code>CONFIG_KALLSYMS</code></td>
<td><code>n</code></td>
</tr>
<tr>
<td>Kernel-Memory-LoadAllSymbols-2</td>
<td><code>CONFIG_KALLSYMS_ALL</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="stack-protection">Stack protection</h2>
<p>To prevent stack-smashing, similar to the stack protector used for ELF programs
in user-space, the kernel can protect its internal stacks as well.</p>
<p>This configuration is supported in <strong>Linux 3.11 and greater</strong> and thus should
only be enabled for such versions.</p>
<p>This configuration also requires building the kernel with the <strong>gcc compiler 4.2
or greater</strong>.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-Stack-1</td>
<td><code>CONFIG_CC_STACKPROTECTOR</code></td>
<td><code>y</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>Other defenses include things like shadow stacks.</p>
<hr />
<h2 id="disable-access-to-devmem">Disable access to /dev/mem</h2>
<p>The /dev/mem file in Linux systems is directly mapped to physical memory. This
can be disastrous if an attacker gains root access, as the attacker would have
direct access to physical memory through this convenient device file. It may not
always be possible to disable such file, as some applications might need such
support. In that case, then this device file should be available only for
authenticated applications.</p>
<p>This configuration is supported in <strong>Linux 4.0 and greater</strong> and thus should
only be disabled for such versions.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-Access-1</td>
<td><code>CONFIG_DEVMEM</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<!-- pagebreak -->

<h2 id="disable-cross-memory-attach">Disable cross-memory attach</h2>
<p>Disable the process_vm_*v syscalls which allow one process to peek/poke the
virtual memory of another.</p>
<p>This configuration is supported in <strong>Linux 3.5 and greater</strong> and thus should
only be disabled for such versions.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-CrossMemAttach-1</td>
<td><code>CROSS_MEMORY_ATTACH</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="stack-smashing-attacks">Stack Smashing Attacks</h2>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>compiler</code> and <code>linker</code> options</th>
<th><em>State</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-StackSmashing-1</td>
<td><code>-fstack-protector-all</code></td>
<td><em>Enable</em></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>Emit extra code to check for buffer overflows, such as stack smashing attacks.</p>
<hr />
<h2 id="detect-buffer-overflows">Detect Buffer Overflows</h2>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>compiler</code> options and <code>config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Memory-BufferOverflows-1</td>
<td><code>-D_FORTIFY_SOURCE</code></td>
<td><code>2</code></td>
</tr>
<tr>
<td>Kernel-Memory-BufferOverflows-2</td>
<td><code>CONFIG_FORTIFY_SOURCE</code></td>
<td><code>y</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>Helps detect some buffer overflow errors.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1.2.4.3_Consoles/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1.2.4.3_Consoles/" class="btn btn-xs btn-link">
        Consoles
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.2.4.1_General/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.2.4.1_General/" class="btn btn-xs btn-link">
        General
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>