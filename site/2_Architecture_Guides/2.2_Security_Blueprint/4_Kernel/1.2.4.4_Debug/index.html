<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Shankho Boron Ghosh">
    <link rel="canonical" href="http://docs.automotivelinux.org/2_Architecture_Guides/2.2_Security_Blueprint/4_Kernel/1.2.4.4_Debug/">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Debug - AGL Documentation</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Debug", url: "#_top", children: [
              {title: "Kernel debug symbols", url: "#kernel-debug-symbols" },
              {title: "Disable Kprobes", url: "#disable-kprobes" },
              {title: "Disable Tracing", url: "#disable-tracing" },
              {title: "Disable Profiling", url: "#disable-profiling" },
              {title: "Disable OOPS print on BUG()", url: "#disable-oops-print-on-bug" },
              {title: "Disable Kernel Debugging", url: "#disable-kernel-debugging" },
              {title: "Disable the kernel debug filesystem", url: "#disable-the-kernel-debug-filesystem" },
              {title: "Disable BUG() support", url: "#disable-bug-support" },
              {title: "Disable core dumps", url: "#disable-core-dumps" },
              {title: "Kernel Address Display Restriction", url: "#kernel-address-display-restriction" },
              {title: "DMESG Restrictions", url: "#dmesg-restrictions" },
              {title: "Disable /proc/config.gz", url: "#disable-procconfiggz" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1.2.4.5_FileSystems/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1.2.4.5_FileSystems/" class="btn btn-xs btn-link">
        File Systems
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.2.4.3_Consoles/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.2.4.3_Consoles/" class="btn btn-xs btn-link">
        Consoles
      </a>
    </div>
    
  </div>

    

    <h1 id="debug">Debug</h1>
<p>No debuggers shall be present on the file system. This includes, but is not
limited to, the GNU Debugger client/server (commonly known in their short form
names such as the <code>gdb</code> and <code>gdbserver</code> executable binaries respectively), the
<code>LLDB</code> next generation debugger or the <code>TCF</code> (Target Communications Framework)
agnostic framework. Including these binaries as part of the file system will
facilitate an attacker's ability to reverse engineer and debug (either locally
or remotely) any process that is currently executing on the device.</p>
<h2 id="kernel-debug-symbols">Kernel debug symbols</h2>
<p>Debug symbols should always be removed from production kernels as they provide a
lot of information to attackers.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-Symbols-1</td>
<td><code>CONFIG_DEBUG_INFO</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>These kernel debug symbols are enabled by other config items in the kernel. Care
should be taken to disable those also. If <code>CONFIG_DEBUG_INFO</code> cannot be
disabled, then enabling <code>CONFIG_DEBUG_INFO_REDUCED</code> is second best.</p>
<!-- section-note -->

<p>At least <code>CONFIG_DEBUG_INFO_REDUCED</code> should be always enabled for developers to
convert addresses in oops messages to line numbers.</p>
<!-- end-section-note -->

<hr />
<h2 id="disable-kprobes">Disable Kprobes</h2>
<p>Kprobes enables you to dynamically break into any kernel routine and collect
debugging and performance information non-disruptively. You can trap at almost
any kernel code address, specifying a handler routine to be invoked when the
breakpoint is hit.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-Kprobes-1</td>
<td><code>CONFIG_KPROBES</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-tracing">Disable Tracing</h2>
<p>FTrace enables the kernel to trace every kernel function. Providing kernel trace
functionality would assist an attacker in discovering attack vectors.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-Tracing-1</td>
<td><code>CONFIG_FTRACE</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-profiling">Disable Profiling</h2>
<p>Profiling and OProfile enables profiling the whole system, include the kernel,
kernel modules, libraries, and applications. Providing profiling functionality
would assist an attacker in discovering attack vectors.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-Profiling-1</td>
<td><code>CONFIG_OPROFILE</code></td>
<td><code>n</code></td>
</tr>
<tr>
<td>Kernel-Debug-Profiling-2</td>
<td><code>CONFIG_PROFILING</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-oops-print-on-bug">Disable OOPS print on BUG()</h2>
<p>The output from OOPS print can be helpful in Return Oriented Programming (ROP)
when trying to determine the effectiveness of an exploit.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-OOPSOnBUG-1</td>
<td><code>CONFIG_DEBUG_BUGVERBOSE</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-kernel-debugging">Disable Kernel Debugging</h2>
<p>There are development-only branches of code in the kernel enabled by the
<code>DEBUG_KERNEL</code> conf. This should be disabled to compile-out these branches.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-Dev-1</td>
<td><code>CONFIG_DEBUG_KERNEL</code></td>
<td><code>n</code></td>
</tr>
<tr>
<td>Kernel-Debug-Dev-2</td>
<td><code>CONFIG_EMBEDDED</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>In some kernel versions, disabling this requires also disabling
<code>CONFIG_EMBEDDED</code>, and <code>CONFIG_EXPERT</code>. Disabling <code>CONFIG_EXPERT</code> makes it
impossible to disable <code>COREDUMP</code>, <code>DEBUG_BUGVERBOSE</code>, <code>NAMESPACES</code>, <code>KALLSYMS</code>
and <code>BUG</code>. In which case it is better to leave this enabled than enable the
others.</p>
<hr />
<!-- pagebreak -->

<h2 id="disable-the-kernel-debug-filesystem">Disable the kernel debug filesystem</h2>
<p>The kernel debug filesystem presents a lot of useful information and means of
manipulation of the kernel to an attacker.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-FileSystem-1</td>
<td><code>CONFIG_DEBUG_FS</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-bug-support">Disable BUG() support</h2>
<p>The kernel will display backtrace and register information for BUGs and WARNs in
kernel space, making it easier for attackers to develop exploits.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-BUG-1</td>
<td><code>CONFIG_BUG</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-core-dumps">Disable core dumps</h2>
<p>Core dumps provide a lot of debug information for hackers. So disabling core
dumps are recommended in production builds.</p>
<p>This configuration is supported in <strong>Linux 3.7 and greater</strong> and thus should
only be disabled for such versions.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-CoreDumps-1</td>
<td><code>CONFIG_COREDUMP</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<!-- pagebreak -->

<h2 id="kernel-address-display-restriction">Kernel Address Display Restriction</h2>
<p>When attackers try to develop "run anywhere" exploits for kernel
vulnerabilities, they frequently need to know the location of internal kernel
structures. By treating kernel addresses as sensitive information, those
locations are not visible to regular local users.</p>
<p><strong>/proc/sys/kernel/kptr_restrict is set to "1"</strong> to block the reporting of known
kernel address leaks.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>File</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-AdressDisplay-1</td>
<td><code>/proc/sys/kernel/kptr_restrict</code></td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>Additionally, various files and directories should be readable only by the root
user: <code>/boot/vmlinuz*</code>, <code>/boot/System.map*</code>, <code>/sys/kernel/debug/</code>,
<code>/proc/slabinfo</code></p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>File</code> or <code>Directorie</code> name</th>
<th><em>State</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-AdressDisplay-1</td>
<td><code>/boot/vmlinuz*</code></td>
<td><em>Readable Only for root user</em></td>
</tr>
<tr>
<td>Kernel-Debug-AdressDisplay-2</td>
<td><code>/boot/System.map*</code></td>
<td><em>Readable Only for root user</em></td>
</tr>
<tr>
<td>Kernel-Debug-AdressDisplay-3</td>
<td><code>/sys/kernel/debug/</code></td>
<td><em>Readable Only for root user</em></td>
</tr>
<tr>
<td>Kernel-Debug-AdressDisplay-4</td>
<td><code>/proc/slabinfo</code></td>
<td><em>Readable Only for root user</em></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="dmesg-restrictions">DMESG Restrictions</h2>
<p>When attackers try to develop "run anywhere" exploits for vulnerabilities, they
frequently will use <code>dmesg</code> output. By treating <code>dmesg</code> output as sensitive
information, this output is not available to the attacker.</p>
<p><strong>/proc/sys/kernel/dmesg_restrict can be set to "1"</strong> to treat dmesg output as
sensitive.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>File</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-DMESG-1</td>
<td><code>/proc/sys/kernel/dmesg_restrict</code></td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>Enable the below compiler and linker options when building user-space
applications to avoid stack smashing, buffer overflow attacks.</p>
<hr />
<!-- pagebreak -->

<h2 id="disable-procconfiggz">Disable /proc/config.gz</h2>
<p>It is extremely important to not expose the kernel configuration used on a
production device to a potential attacker. With access to the kernel config, it
could be possible for an attacker to build a custom kernel for the device that
may disable critical security features.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-Debug-Config-1</td>
<td><code>CONFIG_IKCONFIG</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1.2.4.5_FileSystems/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1.2.4.5_FileSystems/" class="btn btn-xs btn-link">
        File Systems
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.2.4.3_Consoles/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.2.4.3_Consoles/" class="btn btn-xs btn-link">
        Consoles
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>