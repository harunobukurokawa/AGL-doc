<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Shankho Boron Ghosh">
    <link rel="canonical" href="http://docs.automotivelinux.org/2_Architecture_Guides/2.2_Security_Blueprint/4_Kernel/1.2.4.1_General/">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>General - AGL Documentation</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "General configuration", url: "#_top", children: [
              {title: "Mandatory Access Control", url: "#mandatory-access-control" },
              {title: "Disable kexec", url: "#disable-kexec" },
              {title: "Disable kernel IP auto-configuration", url: "#disable-kernel-ip-auto-configuration" },
              {title: "Disable Sysctl syscall support", url: "#disable-sysctl-syscall-support" },
              {title: "Disable Legacy Linux Support", url: "#disable-legacy-linux-support" },
              {title: "Disable firmware auto-loading user mode helper", url: "#disable-firmware-auto-loading-user-mode-helper" },
              {title: "Enable Kernel Panic on OOPS", url: "#enable-kernel-panic-on-oops" },
              {title: "Disable socket monitoring interface", url: "#disable-socket-monitoring-interface" },
              {title: "Disable BPF JIT", url: "#disable-bpf-jit" },
              {title: "Enable Enforced Module Signing", url: "#enable-enforced-module-signing" },
              {title: "Disable all USB, PCMCIA (and other hotplug bus) drivers that aren't needed", url: "#disable-all-usb-pcmcia-and-other-hotplug-bus-drivers-that-arent-needed" },
              {title: "Position Independent Executables", url: "#position-independent-executables" },
              {title: "Prevent Overwrite Attacks", url: "#prevent-overwrite-attacks" },
              {title: "Library linking", url: "#library-linking" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1.2.4.2_Memory/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1.2.4.2_Memory/" class="btn btn-xs btn-link">
        Memory
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.2.4.0_Abstract/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.2.4.0_Abstract/" class="btn btn-xs btn-link">
        Introduction
      </a>
    </div>
    
  </div>

    

    <h1 id="general-configuration">General configuration</h1>
<h2 id="mandatory-access-control">Mandatory Access Control</h2>
<p>Kernel should controls access with labels and policy.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-MAC-1</td>
<td>CONFIG_IP_NF_SECURITY</td>
<td>m</td>
</tr>
<tr>
<td>Kernel-General-MAC-2</td>
<td>CONFIG_IP6_NF_SECURITY</td>
<td>m</td>
</tr>
<tr>
<td>Kernel-General-MAC-3</td>
<td>CONFIG_EXT2_FS_SECURITY</td>
<td>y</td>
</tr>
<tr>
<td>Kernel-General-MAC-4</td>
<td>CONFIG_EXT3_FS_SECURITY</td>
<td>y</td>
</tr>
<tr>
<td>Kernel-General-MAC-5</td>
<td>CONFIG_EXT4_FS_SECURITY</td>
<td>y</td>
</tr>
<tr>
<td>Kernel-General-MAC-6</td>
<td>CONFIG_SECURITY</td>
<td>y</td>
</tr>
<tr>
<td>Kernel-General-MAC-7</td>
<td>CONFIG_SECURITY_SMACK</td>
<td>y</td>
</tr>
<tr>
<td>Kernel-General-MAC-8</td>
<td>CONFIG_TMPFS_XATTR</td>
<td>y</td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>Please also refer to the <a href="../part-5/1-MAC.html"><strong>Mandatory Access Control</strong> documentation in
Platform</a> part. You can also find useful documentation and
links on wikipedia about
<a href="https://en.wikipedia.org/wiki/Mandatory_access_control"><strong>MAC</strong></a> and about
<a href="https://en.wikipedia.org/wiki/Simplified_Mandatory_Access_Control_Kernel"><strong>SMACK</strong></a>.</p>
<hr />
<h2 id="disable-kexec">Disable kexec</h2>
<p><strong>Kexec</strong> is a system call that enables you to load and boot into another kernel
from the currently running kernel. This feature is not required in a production
environment.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-kexec-1</td>
<td><code>CONFIG_KEXEC</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<!-- section-note -->

<p><strong>kexec</strong> can load arbitrary kernels but signing of new kernel can be enforced
like it is can be enforced for new modules.</p>
<!-- end-section-note -->

<hr />
<h2 id="disable-kernel-ip-auto-configuration">Disable kernel IP auto-configuration</h2>
<p>It is preferable to have an IP configuration performed using a user-space tool
as these tend to have more validation. We do not want the network interface
coming up until the system has come up properly.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-IPAutoConf-1</td>
<td><code>CONFIG_IP_PNP</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-sysctl-syscall-support">Disable Sysctl syscall support</h2>
<p>Enabling this will result in code being included that is hard to maintain and
not well tested.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-SysCtl_SysCall-1</td>
<td><code>CONFIG_SYSCTL_SYSCALL</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-legacy-linux-support">Disable Legacy Linux Support</h2>
<p>There are some Kernel Configs which are present only to support legacy binaries.
See also "Consoles" part in order to disabling support for legacy binary
formats. The <code>uselib</code> system call, in particular, has no valid use in any
<code>libc6</code> or <code>uclibc</code> system in recent times. This configuration is supported in
<strong>Linux 3.15 and greater</strong> and thus should only be disabled for such versions.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-LegacyLinux-1</td>
<td><code>CONFIG_USELIB</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-firmware-auto-loading-user-mode-helper">Disable firmware auto-loading user mode helper</h2>
<p>The firmware auto loading helper, which is a utility executed by the kernel on
<code>hotplug</code> events requiring firmware, can to be set <code>setuid</code>. As a result of
this, the helper utility is an attractive target for attackers with control of
physical ports on the device. Disabling this configuration that is supported in
<strong>Linux 3.9 and greater</strong>.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-FirmHelper-1</td>
<td><code>CONFIG_FW_LOADER_USER_HELPER</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<!-- section-note -->

<p>It doesn't strictly need to be <code>setuid</code>, there is an option of shipping firmware
builtin into kernel without initrd/filesystem.</p>
<!-- end-section-note -->

<hr />
<h2 id="enable-kernel-panic-on-oops">Enable Kernel Panic on OOPS</h2>
<p>When fuzzing the kernel or attempting kernel exploits attackers are likely to
trigger kernel OOPSes. Setting the behavior on OOPS to PANIC can impede their
progress.</p>
<p>This configuration is supported in <strong>Linux 3.5 and greater</strong> and thus should
only be enabled for such versions.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-PanicOnOOPS-1</td>
<td><code>CONFIG_PANIC_ON_OOPS</code></td>
<td><code>y</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<!-- pagebreak -->

<h2 id="disable-socket-monitoring-interface">Disable socket monitoring interface</h2>
<p>These monitors can be used to inspect shared file descriptors on Unix Domain
sockets or traffic on 'localhost' which is otherwise assumed to be confidential.</p>
<p>The <code>CONFIG_PACKET_DIAG</code> configuration is supported in <strong>Linux 3.7 and greater</strong>
and thus should only be disabled for such versions.</p>
<p>The <code>CONFIG_UNIX_DIAG</code> configuration is supported in <strong>Linux 3.3 and greater</strong>
and thus should only be disabled for such versions.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-SocketMon-1</td>
<td><code>CONFIG_PACKET_DIAG</code></td>
<td><code>n</code></td>
</tr>
<tr>
<td>Kernel-General-SocketMon-2</td>
<td><code>CONFIG_UNIX_DIAG</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="disable-bpf-jit">Disable BPF JIT</h2>
<p>The BPF JIT can be used to create kernel-payloads from firewall table rules.</p>
<p>This configuration for is supported in <strong>Linux 3.16 and greater</strong> and thus
should only be disabled for such versions.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-BPF_JIT-1</td>
<td><code>CONFIG_BPF_JIT</code></td>
<td><code>n</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="enable-enforced-module-signing">Enable Enforced Module Signing</h2>
<p>The kernel should never allow an unprivileged user the ability to load specific
kernel modules, since that would provide a facility to unexpectedly extend the
available attack surface.</p>
<p>To protect against even privileged users, systems may need to either disable
module loading entirely, or provide signed modules (e.g.
<code>CONFIG_MODULE_SIG_FORCE</code>, or dm-crypt with LoadPin), to keep from having root
load arbitrary kernel code via the module loader interface.</p>
<p>This configuration is supported in <strong>Linux 3.7 and greater</strong> and thus should
only be enabled for such versions.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Config</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-ModuleSigning-1</td>
<td><code>CONFIG_MODULE_SIG_FORCE</code></td>
<td><code>y</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>It is also possible to block the loading of modules after startup with
"kernel.modules_disabled".</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>Variable</code> name</th>
<th><code>Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-ModuleSigning-2</td>
<td><code>kernel.modules_disabled</code></td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<!-- pagebreak -->

<h2 id="disable-all-usb-pcmcia-and-other-hotplug-bus-drivers-that-arent-needed">Disable all USB, PCMCIA (and other <code>hotplug</code> bus) drivers that aren't needed</h2>
<p>To reduce the attack surface, the driver enumeration, probe, and operation
happen in the kernel. The driver data is parsed by the kernel, so any logic bugs
in these drivers can become kernel exploits.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th>Object</th>
<th><em>State</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-Drivers-1</td>
<td><code>USB</code></td>
<td><em>Disabled</em></td>
</tr>
<tr>
<td>Kernel-General-Drivers-2</td>
<td><code>PCMCIA</code></td>
<td><em>Disabled</em></td>
</tr>
<tr>
<td>Kernel-General-Drivers-3</td>
<td>Other <code>hotplug</code> bus</td>
<td><em>Disabled</em></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<hr />
<h2 id="position-independent-executables">Position Independent Executables</h2>
<!-- section-todo -->

<table>
<thead>
<tr>
<th>Domain</th>
<th>Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-IndependentExec-1</td>
<td>Kernel or/and platform part ?</td>
</tr>
</tbody>
</table>
<!-- end-section-todo -->

<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>compiler</code> and <code>linker</code> options</th>
<th><em>State</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-IndependentExec-1</td>
<td><code>-pie -fpic</code></td>
<td><em>Enable</em></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>Produce a position independent executable on targets which supports it.</p>
<hr />
<h2 id="prevent-overwrite-attacks">Prevent Overwrite Attacks</h2>
<p><code>-z,relro</code> linking option helps during program load, several ELF memory sections
need to be written by the linker, but can be turned read-only before turning
over control to the program. This prevents some Global Offset Table GOT
overwrite attacks, or in the dtors section of the ELF binary.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th><code>compiler</code> and <code>linker</code> options</th>
<th><em>State</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-OverwriteAttacks-1</td>
<td><code>-z,relro</code></td>
<td><em>Enable</em></td>
</tr>
<tr>
<td>Kernel-General-OverwriteAttacks-2</td>
<td><code>-z,now</code></td>
<td><em>Enable</em></td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<p>During program load, all dynamic symbols are resolved, allowing for the complete
GOT to be marked read-only (due to <code>-z relro</code> above). This prevents GOT
overwrite attacks. For very large application, this can incur some performance
loss during initial load while symbols are resolved, but this shouldn't be an
issue for daemons.</p>
<hr />
<!-- pagebreak -->

<h2 id="library-linking">Library linking</h2>
<!-- section-todo -->

<table>
<thead>
<tr>
<th>Domain</th>
<th>Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-LibraryLinking-1</td>
<td>Keep this part?</td>
</tr>
</tbody>
</table>
<!-- end-section-todo -->

<p>It is recommended that dynamic linking should generally not be allowed. This
will avoid the user from replacing a library with malicious library.</p>
<!-- section-config -->

<table>
<thead>
<tr>
<th>Domain</th>
<th>Object</th>
<th>Recommendations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel-General-LibraryLinking-1</td>
<td>Dynamic linking</td>
<td>Should generally not be allowed.</td>
</tr>
</tbody>
</table>
<!-- end-section-config -->

<!-- section-note -->

<p>Linking everything statically doesn't change anything wrt security as binaries
will live under same user:group as libraries and setuid executables ignore
<code>LD_PRELOAD/LD_LIBRARY_PATH</code>. It also increases RSS footprint and creates
problems with upgrading.</p>
<!-- end-section-note -->

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1.2.4.2_Memory/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1.2.4.2_Memory/" class="btn btn-xs btn-link">
        Memory
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.2.4.0_Abstract/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.2.4.0_Abstract/" class="btn btn-xs btn-link">
        Introduction
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>